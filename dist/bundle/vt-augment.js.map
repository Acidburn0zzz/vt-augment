{"version":3,"file":"vt-augment.js","sources":["../../node_modules/lscache/lscache.js","../../src/vt-augment.ts","../../src/index.umd.ts"],"sourcesContent":["/**\r\n * lscache library\r\n * Copyright (c) 2011, Pamela Fox\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *       http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n/* jshint undef:true, browser:true, node:true */\r\n/* global define */\r\n\r\n(function (root, factory) {\r\n    if (typeof define === 'function' && define.amd) {\r\n        // AMD. Register as an anonymous module.\r\n        define([], factory);\r\n    } else if (typeof module !== \"undefined\" && module.exports) {\r\n        // CommonJS/Node module\r\n        module.exports = factory();\r\n    } else {\r\n        // Browser globals\r\n        root.lscache = factory();\r\n    }\r\n}(this, function () {\r\n\r\n  // Prefix for all lscache keys\r\n  var CACHE_PREFIX = 'lscache-';\r\n\r\n  // Suffix for the key name on the expiration items in localStorage\r\n  var CACHE_SUFFIX = '-cacheexpiration';\r\n\r\n  // expiration date radix (set to Base-36 for most space savings)\r\n  var EXPIRY_RADIX = 10;\r\n\r\n  // time resolution in milliseconds\r\n  var expiryMilliseconds = 60 * 1000;\r\n  // ECMAScript max Date (epoch + 1e8 days)\r\n  var maxDate = calculateMaxDate(expiryMilliseconds);\r\n\r\n  var cachedStorage;\r\n  var cachedJSON;\r\n  var cacheBucket = '';\r\n  var warnings = false;\r\n\r\n  // Determines if localStorage is supported in the browser;\r\n  // result is cached for better performance instead of being run each time.\r\n  // Feature detection is based on how Modernizr does it;\r\n  // it's not straightforward due to FF4 issues.\r\n  // It's not run at parse-time as it takes 200ms in Android.\r\n  function supportsStorage() {\r\n    var key = '__lscachetest__';\r\n    var value = key;\r\n\r\n    if (cachedStorage !== undefined) {\r\n      return cachedStorage;\r\n    }\r\n\r\n    // some browsers will throw an error if you try to access local storage (e.g. brave browser)\r\n    // hence check is inside a try/catch\r\n    try {\r\n      if (!localStorage) {\r\n        return false;\r\n      }\r\n    } catch (ex) {\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      setItem(key, value);\r\n      removeItem(key);\r\n      cachedStorage = true;\r\n    } catch (e) {\r\n        // If we hit the limit, and we don't have an empty localStorage then it means we have support\r\n        if (isOutOfSpace(e) && localStorage.length) {\r\n            cachedStorage = true; // just maxed it out and even the set test failed.\r\n        } else {\r\n            cachedStorage = false;\r\n        }\r\n    }\r\n    return cachedStorage;\r\n  }\r\n\r\n  // Check to set if the error is us dealing with being out of space\r\n  function isOutOfSpace(e) {\r\n    return e && (\r\n      e.name === 'QUOTA_EXCEEDED_ERR' ||\r\n      e.name === 'NS_ERROR_DOM_QUOTA_REACHED' ||\r\n      e.name === 'QuotaExceededError'\r\n    );\r\n  }\r\n\r\n  // Determines if native JSON (de-)serialization is supported in the browser.\r\n  function supportsJSON() {\r\n    /*jshint eqnull:true */\r\n    if (cachedJSON === undefined) {\r\n      cachedJSON = (window.JSON != null);\r\n    }\r\n    return cachedJSON;\r\n  }\r\n\r\n  /**\r\n   * Returns a string where all RegExp special characters are escaped with a \\.\r\n   * @param {String} text\r\n   * @return {string}\r\n   */\r\n  function escapeRegExpSpecialCharacters(text) {\r\n    return text.replace(/[[\\]{}()*+?.\\\\^$|]/g, '\\\\$&');\r\n  }\r\n\r\n  /**\r\n   * Returns the full string for the localStorage expiration item.\r\n   * @param {String} key\r\n   * @return {string}\r\n   */\r\n  function expirationKey(key) {\r\n    return key + CACHE_SUFFIX;\r\n  }\r\n\r\n  /**\r\n   * Returns the number of minutes since the epoch.\r\n   * @return {number}\r\n   */\r\n  function currentTime() {\r\n    return Math.floor((new Date().getTime())/expiryMilliseconds);\r\n  }\r\n\r\n  /**\r\n   * Wrapper functions for localStorage methods\r\n   */\r\n\r\n  function getItem(key) {\r\n    return localStorage.getItem(CACHE_PREFIX + cacheBucket + key);\r\n  }\r\n\r\n  function setItem(key, value) {\r\n    // Fix for iPad issue - sometimes throws QUOTA_EXCEEDED_ERR on setItem.\r\n    localStorage.removeItem(CACHE_PREFIX + cacheBucket + key);\r\n    localStorage.setItem(CACHE_PREFIX + cacheBucket + key, value);\r\n  }\r\n\r\n  function removeItem(key) {\r\n    localStorage.removeItem(CACHE_PREFIX + cacheBucket + key);\r\n  }\r\n\r\n  function eachKey(fn) {\r\n    var prefixRegExp = new RegExp('^' + CACHE_PREFIX + escapeRegExpSpecialCharacters(cacheBucket) + '(.*)');\r\n    // Loop in reverse as removing items will change indices of tail\r\n    for (var i = localStorage.length-1; i >= 0 ; --i) {\r\n      var key = localStorage.key(i);\r\n      key = key && key.match(prefixRegExp);\r\n      key = key && key[1];\r\n      if (key && key.indexOf(CACHE_SUFFIX) < 0) {\r\n        fn(key, expirationKey(key));\r\n      }\r\n    }\r\n  }\r\n\r\n  function flushItem(key) {\r\n    var exprKey = expirationKey(key);\r\n\r\n    removeItem(key);\r\n    removeItem(exprKey);\r\n  }\r\n\r\n  function flushExpiredItem(key) {\r\n    var exprKey = expirationKey(key);\r\n    var expr = getItem(exprKey);\r\n\r\n    if (expr) {\r\n      var expirationTime = parseInt(expr, EXPIRY_RADIX);\r\n\r\n      // Check if we should actually kick item out of storage\r\n      if (currentTime() >= expirationTime) {\r\n        removeItem(key);\r\n        removeItem(exprKey);\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  function warn(message, err) {\r\n    if (!warnings) return;\r\n    if (!('console' in window) || typeof window.console.warn !== 'function') return;\r\n    window.console.warn(\"lscache - \" + message);\r\n    if (err) window.console.warn(\"lscache - The error was: \" + err.message);\r\n  }\r\n\r\n  function calculateMaxDate(expiryMilliseconds) {\r\n    return Math.floor(8.64e15/expiryMilliseconds);\r\n  }\r\n\r\n  var lscache = {\r\n    /**\r\n     * Stores the value in localStorage. Expires after specified number of minutes.\r\n     * @param {string} key\r\n     * @param {Object|string} value\r\n     * @param {number} time\r\n     * @return true if the value was inserted successfully\r\n     */\r\n    set: function(key, value, time) {\r\n      if (!supportsStorage()) return false;\r\n\r\n      // If we don't get a string value, try to stringify\r\n      // In future, localStorage may properly support storing non-strings\r\n      // and this can be removed.\r\n\r\n      if (!supportsJSON()) return false;\r\n      try {\r\n        value = JSON.stringify(value);\r\n      } catch (e) {\r\n        // Sometimes we can't stringify due to circular refs\r\n        // in complex objects, so we won't bother storing then.\r\n        return false;\r\n      }\r\n\r\n      try {\r\n        setItem(key, value);\r\n      } catch (e) {\r\n        if (isOutOfSpace(e)) {\r\n          // If we exceeded the quota, then we will sort\r\n          // by the expire time, and then remove the N oldest\r\n          var storedKeys = [];\r\n          var storedKey;\r\n          eachKey(function(key, exprKey) {\r\n            var expiration = getItem(exprKey);\r\n            if (expiration) {\r\n              expiration = parseInt(expiration, EXPIRY_RADIX);\r\n            } else {\r\n              // TODO: Store date added for non-expiring items for smarter removal\r\n              expiration = maxDate;\r\n            }\r\n            storedKeys.push({\r\n              key: key,\r\n              size: (getItem(key) || '').length,\r\n              expiration: expiration\r\n            });\r\n          });\r\n          // Sorts the keys with oldest expiration time last\r\n          storedKeys.sort(function(a, b) { return (b.expiration-a.expiration); });\r\n\r\n          var targetSize = (value||'').length;\r\n          while (storedKeys.length && targetSize > 0) {\r\n            storedKey = storedKeys.pop();\r\n            warn(\"Cache is full, removing item with key '\" + key + \"'\");\r\n            flushItem(storedKey.key);\r\n            targetSize -= storedKey.size;\r\n          }\r\n          try {\r\n            setItem(key, value);\r\n          } catch (e) {\r\n            // value may be larger than total quota\r\n            warn(\"Could not add item with key '\" + key + \"', perhaps it's too big?\", e);\r\n            return false;\r\n          }\r\n        } else {\r\n          // If it was some other error, just give up.\r\n          warn(\"Could not add item with key '\" + key + \"'\", e);\r\n          return false;\r\n        }\r\n      }\r\n\r\n      // If a time is specified, store expiration info in localStorage\r\n      if (time) {\r\n        setItem(expirationKey(key), (currentTime() + time).toString(EXPIRY_RADIX));\r\n      } else {\r\n        // In case they previously set a time, remove that info from localStorage.\r\n        removeItem(expirationKey(key));\r\n      }\r\n      return true;\r\n    },\r\n\r\n    /**\r\n     * Retrieves specified value from localStorage, if not expired.\r\n     * @param {string} key\r\n     * @return {string|Object}\r\n     */\r\n    get: function(key) {\r\n      if (!supportsStorage()) return null;\r\n\r\n      // Return the de-serialized item if not expired\r\n      if (flushExpiredItem(key)) { return null; }\r\n\r\n      // Tries to de-serialize stored value if its an object, and returns the normal value otherwise.\r\n      var value = getItem(key);\r\n      if (!value || !supportsJSON()) {\r\n        return value;\r\n      }\r\n\r\n      try {\r\n        // We can't tell if its JSON or a string, so we try to parse\r\n        return JSON.parse(value);\r\n      } catch (e) {\r\n        // If we can't parse, it's probably because it isn't an object\r\n        return value;\r\n      }\r\n    },\r\n\r\n    /**\r\n     * Removes a value from localStorage.\r\n     * Equivalent to 'delete' in memcache, but that's a keyword in JS.\r\n     * @param {string} key\r\n     */\r\n    remove: function(key) {\r\n      if (!supportsStorage()) return;\r\n\r\n      flushItem(key);\r\n    },\r\n\r\n    /**\r\n     * Returns whether local storage is supported.\r\n     * Currently exposed for testing purposes.\r\n     * @return {boolean}\r\n     */\r\n    supported: function() {\r\n      return supportsStorage();\r\n    },\r\n\r\n    /**\r\n     * Flushes all lscache items and expiry markers without affecting rest of localStorage\r\n     */\r\n    flush: function() {\r\n      if (!supportsStorage()) return;\r\n\r\n      eachKey(function(key) {\r\n        flushItem(key);\r\n      });\r\n    },\r\n\r\n    /**\r\n     * Flushes expired lscache items and expiry markers without affecting rest of localStorage\r\n     */\r\n    flushExpired: function() {\r\n      if (!supportsStorage()) return;\r\n\r\n      eachKey(function(key) {\r\n        flushExpiredItem(key);\r\n      });\r\n    },\r\n\r\n    /**\r\n     * Appends CACHE_PREFIX so lscache will partition data in to different buckets.\r\n     * @param {string} bucket\r\n     */\r\n    setBucket: function(bucket) {\r\n      cacheBucket = bucket;\r\n    },\r\n\r\n    /**\r\n     * Resets the string being appended to CACHE_PREFIX so lscache will use the default storage behavior.\r\n     */\r\n    resetBucket: function() {\r\n      cacheBucket = '';\r\n    },\r\n\r\n    /**\r\n     * @returns {number} The currently set number of milliseconds each time unit represents in\r\n     *   the set() function's \"time\" argument.\r\n     */\r\n    getExpiryMilliseconds: function() {\r\n      return expiryMilliseconds;\r\n    },\r\n\r\n    /**\r\n     * Sets the number of milliseconds each time unit represents in the set() function's\r\n     *   \"time\" argument.\r\n     * Sample values:\r\n     *  1: each time unit = 1 millisecond\r\n     *  1000: each time unit = 1 second\r\n     *  60000: each time unit = 1 minute (Default value)\r\n     *  360000: each time unit = 1 hour\r\n     * @param {number} milliseconds\r\n     */\r\n    setExpiryMilliseconds: function(milliseconds) {\r\n        expiryMilliseconds = milliseconds;\r\n        maxDate = calculateMaxDate(expiryMilliseconds);\r\n    },\r\n\r\n    /**\r\n     * Sets whether to display warnings when an item is removed from the cache or not.\r\n     */\r\n    enableWarnings: function(enabled) {\r\n      warnings = enabled;\r\n    }\r\n  };\r\n\r\n  // Return the module\r\n  return lscache;\r\n}));\r\n","import lscache from 'lscache';\n\nexport type VTAugmentOptions = {\n  mode?: 'drawer' | 'embedded',\n}\n\nconst CSS_SCOPE = '4rrgf4';\n\nconst CSS_STYLESHEET = `\n  .vt-augment-${CSS_SCOPE} {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n  }\n  .vt-augment-${CSS_SCOPE}.drawer {\n    width: 700px;\n    background: #313d5a;\n    border: 1px solid #e6e6e6;\n    text-align: left;\n    z-index: 102;\n    position: fixed;\n    right: 0;\n    top: 0;\n    height: 100vh;\n    box-shadow: -4px 5px 8px -3px rgba(17, 17, 17, .16);\n    animation: slideToRight-${CSS_SCOPE} 0.5s 1 forwards;\n    transform: translateX(100vw);\n  }\n  .vt-augment-${CSS_SCOPE}.drawer[opened] {\n    animation: slideFromRight-${CSS_SCOPE} 0.2s 1 forwards;\n  }\n  .vt-augment-${CSS_SCOPE} > .spinner {\n    border: 8px solid rgba(0, 0, 0, 0.2);\n    border-left-color: white;\n    border-radius: 50%;\n    width: 50px;\n    height: 50px;\n    animation: spin-${CSS_SCOPE} 1.2s linear infinite;\n  }\n  @keyframes spin-${CSS_SCOPE} {\n    to { transform: rotate(360deg); }\n  }\n  @keyframes slideFromRight-${CSS_SCOPE} {\n    0% {\n      transform: translateX(100vw);\n    }\n    100% {\n      transform: translateX(0);\n    }\n  }\n  @keyframes slideToRight-${CSS_SCOPE} {\n    100% {\n      transform: translateX(100vw);\n      display: none;\n    }\n  }\n`;\n\nexport class VTAugment {\n\n    protected constructor(\n      public _container: HTMLElement,\n      public _options: VTAugmentOptions) {\n        createStyleSheet();\n        getIframe(_container);\n\n        _container.classList.add(`vt-augment-${CSS_SCOPE}`);\n        // if (_options.mode === 'drawer') {\n          _container.classList.add('drawer');\n        // }\n\n        document.body.addEventListener('click', e => {\n          if (e.target !== _container) {\n            this.closeDrawer();\n          }\n        });\n\n        window.addEventListener('message', (event: any) => {\n        if (event.data === 'VTAUGMENT:READY') {\n          this.loading(false);\n        }\n      });\n      }\n\n    static factory(container: HTMLElement = null, options: VTAugmentOptions = {}) { return new VTAugment(container, options) }\n\n    load(url: string) {\n      const _iframe = getIframe(this._container);\n\n      // iframe html injection not supported, trigger traditional url load\n      if (_iframe.srcdoc === undefined) {\n        this.loading(true);\n        _iframe.src = url;\n        return this;\n      }\n\n      let html = lscache.get(url);\n\n      // html not found in cache neither in fetching process, trigger traditional url load\n      if (!html) {\n        this.loading(true);\n        _iframe.src = url;\n        return this;\n      }\n\n      // html is ready for the iframe injection\n      if (html !== 'fetching') {\n        _iframe.srcdoc = html;\n        return this;\n      }\n\n      // html is still fetching so polling until is ready or timeout\n      if (html === 'fetching') {\n        this.loading(true);\n        const intervalRef = setInterval(() => {\n          html = lscache.get(url);\n\n          if (html && html !== 'fetching') {\n            clearInterval(intervalRef);\n            _iframe.srcdoc = html;\n            this.loading(false);\n          } else if (html === null) {\n            clearInterval(intervalRef);\n            _iframe.src = url;\n          }\n        }, 333);\n      }\n\n      return this;\n    }\n\n    preload(url: string) {\n      const _iframe = getIframe(this._container);\n\n      // Avoid caching if browser doesn't support iframe content injection\n      if (_iframe.srcdoc === undefined) {\n        return;\n      }\n\n      const html = lscache.get(url);\n\n      if (!html) {\n        lscache.set(url, 'fetching', 1);\n        getHtmlAjax(url);\n      }\n    }\n\n    openDrawer() {\n      this._container.setAttribute('opened', '');\n      return this;\n    }\n\n    closeDrawer() {\n      this._container.removeAttribute('opened');\n      return this;\n    }\n\n    listen() {\n      console.error('listen: Not implemented yet');\n      return this;\n    }\n\n    loading(active: boolean) {\n      const _spinner = getSpinner(this._container);\n      const _iframe = getIframe(this._container);\n      _spinner.style.display = active ? 'block' : 'none';\n      _iframe.style.display = active ? 'none' : 'block';\n      return this;\n    }\n}\n\nfunction createStyleSheet() {\n  const _stylesheet = document.createElement('style');\n  _stylesheet.innerHTML = CSS_STYLESHEET;\n  document.body.appendChild(_stylesheet);\n}\n\nfunction getIframe(container: HTMLElement) {\n  let _iframe: HTMLIFrameElement = container.querySelector('iframe');\n\n  if (!_iframe) {\n    _iframe = document.createElement('iframe');\n    _iframe.style.width = '100%';\n    _iframe.style.height = '100%';\n    _iframe.setAttribute('frameborder', '0');\n    container.appendChild(_iframe);\n  }\n\n  return _iframe;\n}\n\nfunction getSpinner(container: HTMLElement) {\n  let _spinner: HTMLElement = container.querySelector('div.spinner');\n\n  if (!_spinner) {\n    _spinner = document.createElement('div');\n    _spinner.classList.add('spinner');\n    container.appendChild(_spinner);\n  }\n\n  return _spinner;\n}\n\nfunction getHtmlAjax(url) {\n  const xmlhr = new XMLHttpRequest();\n\n  xmlhr.onreadystatechange = function () {\n    if (xmlhr.readyState === XMLHttpRequest.DONE) {\n      if (xmlhr.status === 200) {\n        lscache.set(url, xmlhr.response, 60);\n      } else {\n        lscache.remove(url);\n      }\n    }\n  };\n\n  xmlhr.open(\"GET\", url, true);\n  xmlhr.send();\n}\n","import { VTAugment } from \"./vt-augment\"\n\nconst factory = VTAugment.factory\nfactory[\"default\"] = VTAugment.factory\n\n/**\n * Return VTAugment instance.\n */\nexport default factory\n"],"names":["root","factory","module","exports","lscache","this","cachedStorage","cachedJSON","expiryMilliseconds","maxDate","calculateMaxDate","cacheBucket","warnings","supportsStorage","key","undefined","localStorage","ex","setItem","removeItem","e","isOutOfSpace","length","name","supportsJSON","window","JSON","expirationKey","currentTime","Math","floor","Date","getTime","getItem","value","eachKey","fn","prefixRegExp","RegExp","replace","i","match","indexOf","flushItem","exprKey","flushExpiredItem","expr","expirationTime","parseInt","warn","message","err","console","set","time","stringify","storedKey","storedKeys","expiration","push","size","sort","a","b","targetSize","pop","toString","get","parse","remove","supported","flush","flushExpired","setBucket","bucket","resetBucket","getExpiryMilliseconds","setExpiryMilliseconds","milliseconds","enableWarnings","enabled","_container","_options","_stylesheet","document","createElement","innerHTML","body","appendChild","getIframe","classList","add","addEventListener","target","_this","closeDrawer","event","data","loading","VTAugment","container","options","url","_iframe","srcdoc","src","html","intervalRef_1","setInterval","clearInterval","xmlhr","XMLHttpRequest","onreadystatechange","readyState","DONE","status","response","open","send","getHtmlAjax","setAttribute","removeAttribute","error","active","_spinner","querySelector","getSpinner","style","display","width","height"],"mappings":"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"}